<!doctype html>
<html lang="ar">

<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kuwait XI â€“ Final SVG</title>

<style>
:root {
  --bg: #1c2245;
  --pitch: #e4bd79;
  --lines: #1c2245;
}

body {
  margin: 0;
  background: var(--bg);
  display: flex;
  justify-content: center;
  padding: 10px;
  font-family: 'Tahoma', sans-serif;
}

.canvas {
  width: 390px;
  height: 844px;
  background: var(--bg);
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  direction: rtl;
}

.title {
  position: absolute;
  top: 8px;
  width: 100%;
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  color: var(--pitch);
  z-index: 5;
}

/* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø·Ø© */
.formation-select {
  position: absolute;
  top: 32px;
  left: 16px;
  z-index: 6;
}

.formation-select select {
  padding: 4px 8px;
  border-radius: 8px;
  border: none;
  font-size: 12px;
  font-weight: 700;
  background: var(--pitch);
  color: var(--lines);
}

.pitch-wrapper {
  position: absolute;
  top: 64px;
  left: 20px;
  right: 20px;
  height: 520px;
  border-radius: 14px;
  overflow: hidden;
}

.pitch-wrapper svg {
  width: 100%;
  height: 100%;
  display: block;
}

.spot-ring {
  fill: var(--pitch);
  stroke: var(--lines);
  stroke-width: 4;
  filter: url(#shadow);
}

.spot.selected .spot-ring {
  stroke: #ffffff;
}

.spot-name {
  fill: var(--pitch);
  font-size: 9px;
  font-weight: bold;
  text-anchor: middle;
}

/* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
.selectors {
  position: absolute;
  bottom: 12px;
  left: 20px;
  right: 20px;
  z-index: 10;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.selector-box {
  background: var(--pitch);
  border-radius: 14px;
  padding: 6px;
  min-height: 78px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.selector-header {
  font-size: 13px;
  font-weight: 800;
  color: var(--lines);
  text-align: center;
}

.players-list {
  margin-top: 4px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-height: 130px;
  overflow-y: auto;
}

.players-list button {
  border: none;
  border-radius: 10px;
  padding: 5px;
  font-size: 11px;
  display: flex;
  align-items: center;
  gap: 6px;
  background: var(--lines);
  color: var(--pitch);
}

.players-list button img {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  object-fit: cover;
}

.hint {
  position: absolute;
  bottom: 190px;
  right: 20px;
  left: 20px;
  font-size: 11px;
  color: var(--pitch);
  text-align: center;
  opacity: 0.9;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.3.6/dist/dom-to-image-more.min.js"></script>

</head>

<body>

<div class="canvas">

  <div class="title">Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© Ù„Ù…Ù†ØªØ®Ø¨ Ø§Ù„ÙƒÙˆÙŠØª</div>

  <input id="xUser" placeholder="Ø§ÙƒØªØ¨ Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ X"
  style="position:absolute;top:70px;left:50%;transform:translateX(-50%);
  width:70%;padding:10px;border-radius:10px;border:none;
  background:#e4bd79;color:#1c2245;font-size:14px;font-weight:bold;text-align:center;">

  <div class="formation-select">
    <select id="formationSelect">
      <option value="4-4-2">4-4-2</option>
      <option value="4-3-3">4-3-3</option>
      <option value="4-2-3-1">4-2-3-1</option>
      <option value="3-5-2">3-5-2</option>
      <option value="3-4-3">3-4-3</option>
      <option value="5-3-2">5-3-2</option>
    </select>
  </div>

  <button id="saveBtn" style="
    position:absolute;top:32px;right:16px;padding:6px 12px;
    background:#e4bd79;color:#1c2245;border:none;border-radius:8px;
    font-weight:bold;font-size:11px;box-shadow:0 0 6px #00000040;">
    ğŸ’¾ Ø­ÙØ¸
  </button>

  <div class="pitch-wrapper">
    <svg viewBox="0 0 360 600">

      <defs>
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="3" stdDeviation="3" flood-color="rgba(0,0,0,0.5)" />
        </filter>

        <!-- clip paths -->
        <clipPath id="clip0"><circle id="clipCircle0" r="30" /></clipPath>
        <clipPath id="clip1"><circle id="clipCircle1" r="30" /></clipPath>
        <clipPath id="clip2"><circle id="clipCircle2" r="30" /></clipPath>
        <clipPath id="clip3"><circle id="clipCircle3" r="30" /></clipPath>
        <clipPath id="clip4"><circle id="clipCircle4" r="30" /></clipPath>
        <clipPath id="clip5"><circle id="clipCircle5" r="30" /></clipPath>
        <clipPath id="clip6"><circle id="clipCircle6" r="30" /></clipPath>
        <clipPath id="clip7"><circle id="clipCircle7" r="30" /></clipPath>
        <clipPath id="clip8"><circle id="clipCircle8" r="30" /></clipPath>
        <clipPath id="clip9"><circle id="clipCircle9" r="30" /></clipPath>
        <clipPath id="clip10"><circle id="clipCircle10" r="30" /></clipPath>
      </defs>

      <!-- Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù„Ø¹Ø¨ -->
      <rect x="0" y="0" width="360" height="600" fill="var(--pitch)" />

      <!-- Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ù„Ø¹Ø¨ -->
      <rect x="40" y="60" width="280" height="480" fill="none" stroke="var(--lines)" stroke-width="2" />
      <line x1="40" y1="300" x2="320" y2="300" stroke="var(--lines)" stroke-width="2" />
      <circle cx="180" cy="300" r="40" fill="none" stroke="var(--lines)" stroke-width="2" />
      <rect x="80" y="420" width="200" height="120" fill="none" stroke="var(--lines)" stroke-width="2" />
      <rect x="120" y="460" width="120" height="80" fill="none" stroke="var(--lines)" stroke-width="2" />
      <rect x="80" y="60" width="200" height="120" fill="none" stroke="var(--lines)" stroke-width="2" />
      <rect x="120" y="60" width="120" height="80" fill="none" stroke="var(--lines)" stroke-width="2" />

      <!-- Ø§Ù„Ù„ÙˆØ¬Ùˆ -->
      <image href="https://i.postimg.cc/pdy9nJdV/IMG-1720.png" x="155" y="5" width="50" height="50" />

      <!-- Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
      <g class="spot" data-index="0"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip0)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="1"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip1)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="2"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip2)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="3"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip3)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="4"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip4)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="5"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip5)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="6"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip6)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="7"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip7)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="8"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip8)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="9"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip9)"></image><text class="spot-name"></text></g>
      <g class="spot" data-index="10"><circle class="spot-ring" r="30" /><image class="spot-img" width="60" height="60" clip-path="url(#clip10)"></image><text class="spot-name"></text></g>

    </svg>
  </div>

  <div class="hint">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„</div>

  <div class="selectors">

    <div class="selector-box" data-role="GK">
      <div class="selector-header">Ø­Ø§Ø±Ø³ Ù…Ø±Ù…Ù‰</div>
      <div class="players-list"></div>
    </div>

    <div class="selector-box" data-role="DEF">
      <div class="selector-header">Ù…Ø¯Ø§ÙØ¹</div>
      <div class="players-list"></div>
    </div>

    <div class="selector-box" data-role="MID">
      <div class="selector-header">ÙˆØ³Ø·</div>
      <div class="players-list"></div>
    </div>

    <div class="selector-box" data-role="ATT">
      <div class="selector-header">Ù‡Ø¬ÙˆÙ…</div>
      <div class="players-list"></div>
    </div>

  </div>

</div>

<script>

/* Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù„Ø¹Ø¨ */
const PITCH_LEFT = 40, PITCH_RIGHT = 320, PITCH_TOP = 60, PITCH_BOTTOM = 540;
const PW = PITCH_RIGHT - PITCH_LEFT;
const PH = PITCH_BOTTOM - PITCH_TOP;
const mapX = p => PITCH_LEFT + (p/100)*PW;
const mapY = p => PITCH_TOP + (p/100)*PH;

/* Ø§Ù„Ø®Ø·Ø· */
const formations = {
 "4-4-2":[{x:50,y:95},{x:82,y:70},{x:63,y:80},{x:37,y:80},{x:18,y:70},{x:80,y:35},{x:65,y:54},{x:35,y:54},{x:20,y:35},{x:65,y:15},{x:35,y:15}],
 "4-3-3":[{x:50,y:90},{x:82,y:74},{x:63,y:71},{x:37,y:71},{x:18,y:74},{x:35,y:58},{x:50,y:56},{x:65,y:58},{x:24,y:34},{x:50,y:30},{x:76,y:34}],
 "4-2-3-1":[{x:50,y:90},{x:82,y:74},{x:63,y:71},{x:37,y:71},{x:18,y:74},{x:42,y:62},{x:58,y:62},{x:26,y:48},{x:50,y:46},{x:74,y:48},{x:50,y:32}],
 "3-5-2":[{x:50,y:90},{x:30,y:74},{x:50,y:72},{x:70,y:74},{x:15,y:58},{x:32,y:56},{x:50,y:54},{x:68,y:56},{x:85,y:58},{x:42,y:34},{x:58,y:34}],
 "3-4-3":[{x:50,y:90},{x:30,y:74},{x:50,y:72},{x:70,y:74},{x:30,y:58},{x:50,y:56},{x:70,y:58},{x:50,y:48},{x:24,y:34},{x:50,y:32},{x:76,y:34}],
 "5-3-2":[{x:50,y:90},{x:12,y:76},{x:30,y:72},{x:50,y:70},{x:70,y:72},{x:88,y:76},{x:35,y:58},{x:50,y:56},{x:65,y:58},{x:42,y:34},{x:58,y:34}]
};

/* Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
const playersData = {
  GK:[{name:"Ø³Ù…ÙŠØ± Ø³Ø¹ÙŠØ¯",img:"https://i.postimg.cc/8zpGYXRv/IMG_1707.png"}],
  DEF:[
    {name:"Ù†Ø¹ÙŠÙ… Ø³Ø¹Ø¯",img:"https://i.postimg.cc/T3dxsNVL/IMG_1708.png"},
    {name:"Ø¹Ø§Ø¯Ù„ Ø¹Ø¨Ø§Ø³",img:"https://i.postimg.cc/3x8hqfXy/IMG_1709.png"}
  ],
  MID:[
    {name:"Ø³Ø¹Ø¯ Ø§Ù„Ø­ÙˆØ·ÙŠ",img:"https://i.postimg.cc/L89SWQtj/IMG_1710.png"},
    {name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±Ø§Ù†",img:"https://i.postimg.cc/cLFWG7hR/IMG_1711.png"}
  ],
  ATT:[
    {name:"ÙÙŠØµÙ„ Ø§Ù„Ø¯Ø®ÙŠÙ„",img:"https://i.postimg.cc/qv1rHcwS/IMG_1712.png"},
    {name:"Ø¬Ø§Ø³Ù… ÙŠØ¹Ù‚ÙˆØ¨",img:"https://i.postimg.cc/Dwxh3Q5V/IMG_1713.png"}
  ]
};

/* ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ø·Ø© */
const spots=[...document.querySelectorAll(".spot")];
let selectedIndex=null;

function applyFormation(key){
  formations[key].forEach((p,i)=>{
    const cx=mapX(p.x), cy=mapY(p.y);
    const g=spots[i];

    g.querySelector(".spot-ring").setAttribute("cx",cx);
    g.querySelector(".spot-ring").setAttribute("cy",cy);

    g.querySelector(".spot-img").setAttribute("x",cx-30);
    g.querySelector(".spot-img").setAttribute("y",cy-30);

    g.querySelector(".spot-name").setAttribute("x",cx);
    g.querySelector(".spot-name").setAttribute("y",cy+40);

    document.getElementById("clipCircle"+i).setAttribute("cx",cx);
    document.getElementById("clipCircle"+i).setAttribute("cy",cy);
  });
}

applyFormation("4-4-2");

document.getElementById("formationSelect").onchange=e=>applyFormation(e.target.value);

/* Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø§Ø¦Ø±Ø© */
spots.forEach((g,i)=>{
  g.onclick=()=>{
    selectedIndex=i;
    spots.forEach(s=>s.classList.remove("selected"));
    g.classList.add("selected");
  };
});

/* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
document.querySelectorAll(".selector-box").forEach(box=>{
  const role=box.dataset.role;
  const players=playersData[role];
  const list=box.querySelector(".players-list");

  players.forEach(p=>{
    const btn=document.createElement("button");
    btn.innerHTML=`<img src="${p.img}"><span>${p.name}</span>`;
    btn.onclick=()=>assignPlayer(p);
    list.appendChild(btn);
  });
});

/* ØªØ¹ÙŠÙŠÙ† Ù„Ø§Ø¹Ø¨ */
function assignPlayer(p){
  if(selectedIndex===null){alert("Ø§Ø®ØªØ± Ø¯Ø§Ø¦Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹");return;}
  const g=spots[selectedIndex];
  g.querySelector(".spot-img").setAttribute("href",p.img);
  g.querySelector(".spot-name").textContent=p.name;
  g.classList.remove("selected");
  selectedIndex=null;
}

/* Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø®ØªÙ… X */
document.getElementById("saveBtn").onclick=()=>{

  const username=document.getElementById("xUser").value.trim()||"Unknown";
  const avatarUrl=`https://unavatar.io/twitter/${username}`;
  const node=document.querySelector(".pitch-wrapper");

  domtoimage.toCanvas(node,{quality:1})
  .then(canvas=>{

    const finalCanvas=document.createElement("canvas");
    const ctx=finalCanvas.getContext("2d");

    finalCanvas.width=canvas.width;
    finalCanvas.height=canvas.height+200;

    ctx.fillStyle="#1c2245";
    ctx.fillRect(0,0,finalCanvas.width,finalCanvas.height);

    ctx.drawImage(canvas,0,0);

    const stamp=new Image();
    stamp.crossOrigin="anonymous";
    stamp.src=avatarUrl;

    stamp.onload=()=>{

      const size=140, posX=30, posY=finalCanvas.height-size-30;

      ctx.beginPath();
      ctx.arc(posX+size/2,posY+size/2,size/2,0,Math.PI*2);
      ctx.fillStyle="#e4bd79";
      ctx.fill();

      ctx.lineWidth=8;
      ctx.strokeStyle="#1c2245";
      ctx.stroke();

      ctx.save();
      ctx.clip();
      ctx.drawImage(stamp,posX,posY,size,size);
      ctx.restore();

      ctx.font="bold 44px Tahoma";
      ctx.fillStyle="#ffffff";
      ctx.fillText(`@${username}`,posX+size+30,posY+size/2);

      const link=document.createElement("a");
      link.download="formation.png";
      link.href=finalCanvas.toDataURL("image/png");
      link.click();
    };
  });
};

</script>

</body>
</html>